<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- we will use semantic ui for better styles -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.css"
    />
  </head>
  <body>
    <div class="ui container">
      <h1>
        <a href="/stock">Stocks</a>
        <i class="arrow alternate circle right outline icon"></i>
        {{stock_details[0].name}}
      </h1>
      <div class="three ui buttons">
        <button class="ui button">
            <a href="/stock/{{stock_details[0].symbol}}/assets">
              Stock Assets
            </a>
        </button>
        <button class="ui button">
            <a href="/stock/{{stock_details[0].symbol}}/stock_financials">
              Stock Financials
            </a>
        </button>
        
        <!-- to fetch the latest news  -->
        <button class="ui button">
          <a href="/stock/{{stock_details[0].symbol}}/latest_news">
            Get Latest News
          </a>
        </button>
      </div>


      <div class="three ui buttons">
        <button class="ui button">
            <a href="/stock/{{stock_details[0].symbol}}/trends">
              Recommendation Trends
            </a>
        </button>
        <button class="ui button">
            
        </button>
        <button class="ui button">
          <a href="/stock/{{stock_details[0].symbol}}/earnings">
            Earnings
          </a>
        </button>
      </div>

      <!-- TradingView Widget BEGIN -->
      <div
        class="tradingview-widget-container"
        style="height: 610px; width: 100%"
      >
        <div
          id="tradingview_chart"
          style="height: calc(100% - 32px); width: 100%"
        ></div>
        <div class="tradingview-widget-copyright">
          <a
            href="https://www.tradingview.com/symbols/{{stock_details[0].exchange}}-{{stock_details[0].symbol}}/"
            rel="noopener nofollow"
            target="_blank"
          >
            <span class="blue-text"
              >{{stock_details[0].symbol}} stock chart</span
            >
          </a>
          <span class="trademark"> by TradingView</span>
        </div>
      </div>

      <script src="https://s3.tradingview.com/tv.js"></script>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          new TradingView.widget({
            container_id: "tradingview_chart",
            autosize: true,
            symbol: "{{stock_details[0].exchange}}:{{stock_details[0].symbol}}",
            interval: "D",
            timezone: "Etc/UTC",
            theme: "dark",
            style: "1",
            hide_side_toolbar: true,
            allow_symbol_change: true,
            backgroundColor: "#0F0F0F",
            gridColor: "rgba(242, 242, 242, 0.06)",
            locale: "en",
          });
        });
      </script>
      <!-- TradingView Widget END -->
      <!-- added a form to give option to user to select strategies -->
      

      <!-- we will use post method for the strategies , because when we apply some strategy,
      we have to make changes to the dataBase itself.
      Here , we will show strategy names in the drop down .
      we will pass the strategy id as value of it -->
      <!-- when we click on apply strategy we will be redirected to the /apply_strategy -->

      <form method="post" action="/apply_strategy"> 
        <select name="strategy_id">
            <option value="">Strategies</option>
            {%for strategy in strategies%}
            <option value={{strategy.id}}>{{strategy.name}}</option>
            {% endfor %}
        </select>
        <!-- we also have to pass the stock id on which we are applying the strategy .
        so we will pass the stock id in the form itself-->
        <input type="hidden" name="stock_id" value="{{stock_details[0].id}}">
        <input type="submit" value="Apply Strategy">
    </form>
    
    <table class="ui selectable inverted table">
        <thead>
          <tr>
            <th>Symbol</th>
            <th>Date</th>
            <th>Close</th>
            <th>High</th>
            <th>Low</th>
            <th>Open</th>
            <th>Volume</th>
          </tr>
        </thead>
        <tbody>
          <!-- here we are looping through 30 days data one by one -->
          {% for stock in stock_details %} 
          <tr>
            <td>{{stock.symbol}}</td>
            <td>{{stock.date}}</td>
            <td>{{stock.close}}</td>
            <td>{{stock.high}}</td>
            <td>{{stock.low}}</td>
            <td>{{stock.open}}</td>
            <td>{{stock.volume}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.js"></script>
  </body>
</html>
